var Zr=Object.create;var ne=Object.defineProperty;var Jr=Object.getOwnPropertyDescriptor;var Qr=Object.getOwnPropertyNames;var kr=Object.getPrototypeOf,ei=Object.prototype.hasOwnProperty;var u=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),ti=(t,e)=>{for(var r in e)ne(t,r,{get:e[r],enumerable:!0})},ht=(t,e,r,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Qr(e))!ei.call(t,n)&&n!==r&&ne(t,n,{get:()=>e[n],enumerable:!(i=Jr(e,n))||i.enumerable});return t};var Ie=(t,e,r)=>(r=t!=null?Zr(kr(t)):{},ht(e||!t||!t.__esModule?ne(r,"default",{value:t,enumerable:!0}):r,t)),ri=t=>ht(ne({},"__esModule",{value:!0}),t);var bt=u(_t=>{"use strict";Object.defineProperty(_t,"__esModule",{value:!0})});var vt=u(N=>{"use strict";var ii=N&&N.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),ni=N&&N.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&ii(e,t,r)};Object.defineProperty(N,"__esModule",{value:!0});ni(bt(),N)});var pt=u(se=>{"use strict";Object.defineProperty(se,"__esModule",{value:!0});se.Utility=void 0;var De=class{constructor(){this.coldStart=!0,this.defaultServiceName="service_undefined"}getColdStart(){return this.coldStart?(this.coldStart=!1,!0):!1}isColdStart(){return this.getColdStart()}getDefaultServiceName(){return this.defaultServiceName}isValidServiceName(e){return typeof e=="string"&&e.trim().length>0}};se.Utility=De});var mt=u(oe=>{"use strict";Object.defineProperty(oe,"__esModule",{value:!0});oe.ConfigService=void 0;var Ve=class{};oe.ConfigService=Ve});var yt=u(ae=>{"use strict";Object.defineProperty(ae,"__esModule",{value:!0});ae.EnvironmentVariablesService=void 0;var qe=class{constructor(){this.devModeVariable="POWERTOOLS_DEV",this.serviceNameVariable="POWERTOOLS_SERVICE_NAME",this.xRayTraceIdVariable="_X_AMZN_TRACE_ID"}get(e){return process.env[e]?.trim()||""}getServiceName(){return this.get(this.serviceNameVariable)}getXrayTraceId(){return this.getXrayTraceData()?.Root}getXrayTraceSampled(){return this.getXrayTraceData()?.Sampled==="1"}isDevMode(){return this.isValueTrue(this.get(this.devModeVariable))}isValueTrue(e){return["1","y","yes","t","true","on"].includes(e.toLowerCase())}getXrayTraceData(){let e=this.get(this.xRayTraceIdVariable);if(e==="")return;if(!e.includes("="))return{Root:e};let r={};return e.split(";").forEach(i=>{let[n,s]=i.split("=");r[n]=s}),r}};ae.EnvironmentVariablesService=qe});var St=u(w=>{"use strict";var si=w&&w.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),Ot=w&&w.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&si(e,t,r)};Object.defineProperty(w,"__esModule",{value:!0});Ot(mt(),w);Ot(yt(),w)});var Et=u(ue=>{"use strict";Object.defineProperty(ue,"__esModule",{value:!0});ue.helloworldContext=void 0;var oi={callbackWaitsForEmptyEventLoop:!0,functionVersion:"$LATEST",functionName:"foo-bar-function",memoryLimitInMB:"128",logGroupName:"/aws/lambda/foo-bar-function-123456abcdef",logStreamName:"2021/03/09/[$LATEST]abcdef123456abcdef123456abcdef123456",invokedFunctionArn:"arn:aws:lambda:eu-west-1:123456789012:function:foo-bar-function",awsRequestId:"c6af9ac6-7b61-11e6-9a41-93e812345678",getRemainingTimeInMillis:()=>1234,done:()=>console.log("Done!"),fail:()=>console.log("Failed!"),succeed:()=>console.log("Succeeded!")};ue.helloworldContext=oi});var Mt=u(I=>{"use strict";var ai=I&&I.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),ui=I&&I.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&ai(e,t,r)};Object.defineProperty(I,"__esModule",{value:!0});ui(Et(),I)});var Lt=u(ce=>{"use strict";Object.defineProperty(ce,"__esModule",{value:!0});ce.CustomEvent=void 0;ce.CustomEvent={key1:"value1",key2:"value2",key3:"value3"}});var wt=u(v=>{"use strict";var ci=v&&v.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),li=v&&v.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),di=v&&v.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&ci(e,t,r);return li(e,t),e};Object.defineProperty(v,"__esModule",{value:!0});v.Custom=void 0;v.Custom=di(Lt())});var Pt=u(Ct=>{"use strict";Object.defineProperty(Ct,"__esModule",{value:!0})});var Tt=u(p=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0});p.isNullOrUndefined=p.isTruthy=p.isString=p.isRecord=void 0;var At=t=>Object.prototype.toString.call(t)==="[object Object]"&&!Object.is(t,null);p.isRecord=At;var fi=t=>typeof t=="string"?t!=="":typeof t=="number"?t!==0:typeof t=="boolean"?t:Array.isArray(t)?t.length>0:At(t)?Object.keys(t).length>0:!1;p.isTruthy=fi;var gi=t=>Object.is(t,null)||Object.is(t,void 0);p.isNullOrUndefined=gi;var hi=t=>typeof t=="string";p.isString=hi});var jt=u(le=>{"use strict";Object.defineProperty(le,"__esModule",{value:!0});le.PT_VERSION=void 0;le.PT_VERSION="1.18.1"});var Be=u(de=>{"use strict";Object.defineProperty(de,"__esModule",{value:!0});de.isSdkClient=void 0;var _i=t=>typeof t=="object"&&t!==null&&"send"in t&&typeof t.send=="function"&&"config"in t&&t.config!==void 0&&typeof t.config=="object"&&t.config!==null&&"middlewareStack"in t&&t.middlewareStack!==void 0&&typeof t.middlewareStack=="object"&&t.middlewareStack!==null&&"identify"in t.middlewareStack&&typeof t.middlewareStack.identify=="function"&&"addRelativeTo"in t.middlewareStack&&typeof t.middlewareStack.addRelativeTo=="function";de.isSdkClient=_i});var Nt=u(G=>{"use strict";Object.defineProperty(G,"__esModule",{value:!0});G.addUserAgentMiddleware=G.customUserAgentMiddleware=void 0;var bi=jt(),vi=Be(),pi=process.env.AWS_EXECUTION_ENV||"NA",mi={relation:"after",toMiddleware:"getUserAgentMiddleware",name:"addPowertoolsToUserAgent",tags:["POWERTOOLS","USER_AGENT"]},Rt=t=>e=>async r=>{let i=`PT/${t}/${bi.PT_VERSION} PTEnv/${pi}`;return r.request.headers["user-agent"]=`${r.request.headers["user-agent"]} ${i}`,await e(r)};G.customUserAgentMiddleware=Rt;var yi=t=>{let e=!1;for(let r of t)r.includes("addPowertoolsToUserAgent")&&(e=!0);return e},Oi=(t,e)=>{try{if((0,vi.isSdkClient)(t)){if(yi(t.middlewareStack.identify()))return;t.middlewareStack.addRelativeTo(Rt(e),mi)}else throw new Error("The client provided does not match the expected interface")}catch(r){console.warn("Failed to add user agent middleware",r)}};G.addUserAgentMiddleware=Oi});var It=u(K=>{"use strict";Object.defineProperty(K,"__esModule",{value:!0});K.isSdkClient=K.addUserAgentMiddleware=void 0;var Si=Nt();Object.defineProperty(K,"addUserAgentMiddleware",{enumerable:!0,get:function(){return Si.addUserAgentMiddleware}});var Ei=Be();Object.defineProperty(K,"isSdkClient",{enumerable:!0,get:function(){return Ei.isSdkClient}})});var H=u(g=>{"use strict";var Dt=g&&g.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),Mi=g&&g.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),X=g&&g.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Dt(e,t,r)},Vt=g&&g.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&Dt(e,t,r);return Mi(e,t),e};Object.defineProperty(g,"__esModule",{value:!0});g.Events=g.ContextExamples=void 0;X(vt(),g);X(pt(),g);X(St(),g);g.ContextExamples=Vt(Mt());g.Events=Vt(wt());X(Pt(),g);X(Tt(),g);X(It(),g)});var Bt=u(qt=>{"use strict";Object.defineProperty(qt,"__esModule",{value:!0})});var Ft=u(fe=>{"use strict";Object.defineProperty(fe,"__esModule",{value:!0});fe.EnvironmentVariablesService=void 0;var Li=H(),Fe=class extends Li.EnvironmentVariablesService{constructor(){super(...arguments),this.namespaceVariable="POWERTOOLS_METRICS_NAMESPACE"}getNamespace(){return this.get(this.namespaceVariable)}};fe.EnvironmentVariablesService=Fe});var Gt=u(C=>{"use strict";var wi=C&&C.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),Ut=C&&C.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&wi(e,t,r)};Object.defineProperty(C,"__esModule",{value:!0});Ut(Bt(),C);Ut(Ft(),C)});var Kt=u(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0});h.MAX_DIMENSION_COUNT=h.MAX_METRIC_VALUES_SIZE=h.MAX_METRICS_SIZE=h.DEFAULT_NAMESPACE=h.COLD_START_METRIC=void 0;var Ci="ColdStart";h.COLD_START_METRIC=Ci;var Pi="default_namespace";h.DEFAULT_NAMESPACE=Pi;var Ai=100;h.MAX_METRICS_SIZE=Ai;var Ti=100;h.MAX_METRIC_VALUES_SIZE=Ti;var ji=29;h.MAX_DIMENSION_COUNT=ji});var $t=u(Xt=>{"use strict";Object.defineProperty(Xt,"__esModule",{value:!0})});var zt=u(ge=>{"use strict";Object.defineProperty(ge,"__esModule",{value:!0});ge.MetricUnits=void 0;var Yt;(function(t){t.Seconds="Seconds",t.Microseconds="Microseconds",t.Milliseconds="Milliseconds",t.Bytes="Bytes",t.Kilobytes="Kilobytes",t.Megabytes="Megabytes",t.Gigabytes="Gigabytes",t.Terabytes="Terabytes",t.Bits="Bits",t.Kilobits="Kilobits",t.Megabits="Megabits",t.Gigabits="Gigabits",t.Terabits="Terabits",t.Percent="Percent",t.Count="Count",t.BytesPerSecond="Bytes/Second",t.KilobytesPerSecond="Kilobytes/Second",t.MegabytesPerSecond="Megabytes/Second",t.GigabytesPerSecond="Gigabytes/Second",t.TerabytesPerSecond="Terabytes/Second",t.BitsPerSecond="Bits/Second",t.KilobitsPerSecond="Kilobits/Second",t.MegabitsPerSecond="Megabits/Second",t.GigabitsPerSecond="Gigabits/Second",t.TerabitsPerSecond="Terabits/Second",t.CountPerSecond="Count/Second"})(Yt||(ge.MetricUnits=Yt={}))});var Wt=u(he=>{"use strict";Object.defineProperty(he,"__esModule",{value:!0});he.MetricResolution=void 0;var Ri={Standard:60,High:1};he.MetricResolution=Ri});var xt=u(y=>{"use strict";var Ni=y&&y.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),Ue=y&&y.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Ni(e,t,r)};Object.defineProperty(y,"__esModule",{value:!0});Ue($t(),y);Ue(zt(),y);Ue(Wt(),y)});var Ht=u(P=>{"use strict";Object.defineProperty(P,"__esModule",{value:!0});P.MetricResolution=P.MetricUnits=P.Metrics=void 0;var Ii=require("node:console"),Di=H(),Vi=Gt(),O=Kt(),Z=xt();Object.defineProperty(P,"MetricUnits",{enumerable:!0,get:function(){return Z.MetricUnits}});Object.defineProperty(P,"MetricResolution",{enumerable:!0,get:function(){return Z.MetricResolution}});var Ge=class t extends Di.Utility{constructor(e={}){super(),this.defaultDimensions={},this.dimensions={},this.isSingleMetric=!1,this.metadata={},this.shouldThrowOnEmptyMetrics=!1,this.storedMetrics={},this.dimensions={},this.setOptions(e)}addDimension(e,r){if(O.MAX_DIMENSION_COUNT<=this.getCurrentDimensionsCount())throw new RangeError(`The number of metric dimensions must be lower than ${O.MAX_DIMENSION_COUNT}`);this.dimensions[e]=r}addDimensions(e){let r={...this.dimensions};if(Object.keys(e).forEach(i=>{r[i]=e[i]}),Object.keys(r).length>O.MAX_DIMENSION_COUNT)throw new RangeError(`Unable to add ${Object.keys(e).length} dimensions: the number of metric dimensions must be lower than ${O.MAX_DIMENSION_COUNT}`);this.dimensions=r}addMetadata(e,r){this.metadata[e]=r}addMetric(e,r,i,n=Z.MetricResolution.Standard){this.storeMetric(e,r,i,n),this.isSingleMetric&&this.publishStoredMetrics()}captureColdStartMetric(){if(!this.isColdStart())return;let e=this.singleMetric();this.defaultDimensions.service&&e.setDefaultDimensions({service:this.defaultDimensions.service}),this.functionName!=null&&e.addDimension("function_name",this.functionName),e.addMetric(O.COLD_START_METRIC,Z.MetricUnits.Count,1)}clearDefaultDimensions(){this.defaultDimensions={}}clearDimensions(){this.dimensions={}}clearMetadata(){this.metadata={}}clearMetrics(){this.storedMetrics={}}logMetrics(e={}){let{throwOnEmptyMetrics:r,defaultDimensions:i,captureColdStartMetric:n}=e;return r&&this.throwOnEmptyMetrics(),i!==void 0&&this.setDefaultDimensions(i),(s,a,o)=>{let c=o.value,l=this;return o.value=async function(f,b,R){l.functionName=b.functionName,n&&l.captureColdStartMetric();let U;try{U=await c.apply(this,[f,b,R])}catch(ie){throw ie}finally{l.publishStoredMetrics()}return U},o}}publishStoredMetrics(){!this.shouldThrowOnEmptyMetrics&&Object.keys(this.storedMetrics).length===0&&console.warn("No application metrics to publish. The cold-start metric may be published if enabled. If application metrics should never be empty, consider using `throwOnEmptyMetrics`");let e=this.serializeMetrics();this.console.log(JSON.stringify(e)),this.clearMetrics(),this.clearDimensions(),this.clearMetadata()}serializeMetrics(){let e=Object.values(this.storedMetrics).map(n=>({Name:n.name,Unit:n.unit,...n.resolution===Z.MetricResolution.High?{StorageResolution:n.resolution}:{}}));if(e.length===0&&this.shouldThrowOnEmptyMetrics)throw new RangeError("The number of metrics recorded must be higher than zero");this.namespace||console.warn("Namespace should be defined, default used");let r=Object.values(this.storedMetrics).reduce((n,{name:s,value:a})=>(n[s]=a,n),{}),i=[...new Set([...Object.keys(this.defaultDimensions),...Object.keys(this.dimensions)])];return{_aws:{Timestamp:new Date().getTime(),CloudWatchMetrics:[{Namespace:this.namespace||O.DEFAULT_NAMESPACE,Dimensions:[i],Metrics:e}]},...this.defaultDimensions,...this.dimensions,...r,...this.metadata}}setDefaultDimensions(e){let r={...this.defaultDimensions,...e};if(O.MAX_DIMENSION_COUNT<=Object.keys(r).length)throw new Error("Max dimension count hit");this.defaultDimensions=r}setFunctionName(e){this.functionName=e}singleMetric(){return new t({namespace:this.namespace,serviceName:this.dimensions.service,defaultDimensions:this.defaultDimensions,singleMetric:!0})}throwOnEmptyMetrics(){this.shouldThrowOnEmptyMetrics=!0}getCurrentDimensionsCount(){return Object.keys(this.dimensions).length+Object.keys(this.defaultDimensions).length}getCustomConfigService(){return this.customConfigService}getEnvVarsService(){return this.envVarsService}isNewMetric(e,r){if(this.storedMetrics[e]){if(this.storedMetrics[e].unit!==r){let i=this.storedMetrics[e].unit;throw new Error(`Metric "${e}" has already been added with unit "${i}", but we received unit "${r}". Did you mean to use metric unit "${i}"?`)}return!1}else return!0}setConsole(){this.getEnvVarsService().isDevMode()?this.console=console:this.console=new Ii.Console({stdout:process.stdout,stderr:process.stderr})}setCustomConfigService(e){this.customConfigService=e||void 0}setEnvVarsService(){this.envVarsService=new Vi.EnvironmentVariablesService}setNamespace(e){this.namespace=e||this.getCustomConfigService()?.getNamespace()||this.getEnvVarsService().getNamespace()}setOptions(e){let{customConfigService:r,namespace:i,serviceName:n,singleMetric:s,defaultDimensions:a}=e;return this.setEnvVarsService(),this.setConsole(),this.setCustomConfigService(r),this.setNamespace(i),this.setService(n),this.setDefaultDimensions(a),this.isSingleMetric=s||!1,this}setService(e){let r=e||this.getCustomConfigService()?.getServiceName()||this.getEnvVarsService().getServiceName()||this.getDefaultServiceName();r.length>0&&this.setDefaultDimensions({service:r})}storeMetric(e,r,i,n){if(Object.keys(this.storedMetrics).length>=O.MAX_METRICS_SIZE&&this.publishStoredMetrics(),this.isNewMetric(e,r))this.storedMetrics[e]={unit:r,value:i,name:e,resolution:n};else{let s=this.storedMetrics[e];Array.isArray(s.value)||(s.value=[s.value]),s.value.push(i),s.value.length===O.MAX_METRIC_VALUES_SIZE&&this.publishStoredMetrics()}}};P.Metrics=Ge});var Jt=u(Zt=>{"use strict";Object.defineProperty(Zt,"__esModule",{value:!0})});var Ke=u(_=>{"use strict";Object.defineProperty(_,"__esModule",{value:!0});_.IDEMPOTENCY_KEY=_.LOGGER_KEY=_.METRICS_KEY=_.TRACER_KEY=_.PREFIX=void 0;var J="powertools-for-aws";_.PREFIX=J;var qi=`${J}.tracer`;_.TRACER_KEY=qi;var Bi=`${J}.metrics`;_.METRICS_KEY=Bi;var Fi=`${J}.logger`;_.LOGGER_KEY=Fi;var Ui=`${J}.idempotency`;_.IDEMPOTENCY_KEY=Ui});var Qt=u(be=>{"use strict";Object.defineProperty(be,"__esModule",{value:!0});be.cleanupMiddlewares=void 0;var _e=Ke(),Gi=t=>typeof t=="function",Ki=async t=>{let e=[_e.TRACER_KEY,_e.METRICS_KEY,_e.LOGGER_KEY,_e.IDEMPOTENCY_KEY];for(let r of e)if(Object(t.internal).hasOwnProperty(r)){let i=t.internal[r];Gi(i)&&await i(t)}};be.cleanupMiddlewares=Ki});var Xe=u(A=>{"use strict";var Xi=A&&A.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),kt=A&&A.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Xi(e,t,r)};Object.defineProperty(A,"__esModule",{value:!0});kt(Qt(),A);kt(Ke(),A)});var er=u(ve=>{"use strict";Object.defineProperty(ve,"__esModule",{value:!0});ve.logMetrics=void 0;var $i=Xe(),Yi=(t,e={})=>{let r=t instanceof Array?t:[t],i=a=>{a.internal={...a.internal,[$i.METRICS_KEY]:s}},n=async a=>{r.forEach(o=>{o.setFunctionName(a.context.functionName);let{throwOnEmptyMetrics:c,defaultDimensions:l,captureColdStartMetric:f}=e;c&&o.throwOnEmptyMetrics(),l!==void 0&&o.setDefaultDimensions(l),f&&o.captureColdStartMetric()}),i(a)},s=async()=>{r.forEach(a=>{a.publishStoredMetrics()})};return{before:n,after:s,onError:s}};ve.logMetrics=Yi});var tr=u(D=>{"use strict";var zi=D&&D.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),Wi=D&&D.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&zi(e,t,r)};Object.defineProperty(D,"__esModule",{value:!0});Wi(er(),D)});var Ye=u(S=>{"use strict";var xi=S&&S.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),$e=S&&S.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&xi(e,t,r)};Object.defineProperty(S,"__esModule",{value:!0});$e(Ht(),S);$e(Jt(),S);$e(tr(),S)});var rr=u(pe=>{"use strict";Object.defineProperty(pe,"__esModule",{value:!0});pe.createLogger=void 0;var Hi=ze(),Zi=(t={})=>new Hi.Logger(t);pe.createLogger=Zi});var ir=u(me=>{"use strict";Object.defineProperty(me,"__esModule",{value:!0});me.LogFormatter=void 0;var Ji=t=>"cause"in t,We=class{formatError(e){return{name:e.name,location:this.getCodeLocation(e.stack),message:e.message,stack:e.stack,cause:Ji(e)?e.cause instanceof Error?this.formatError(e.cause):e.cause:void 0}}formatTimestamp(e){return e.toISOString()}getCodeLocation(e){if(!e)return"";let r=e.split(`
`),i=/\((.*):(\d+):(\d+)\)\\?$/,n;for(n=0;n<r.length;n++){let s=i.exec(r[n]);if(Array.isArray(s))return`${s[1]}:${Number(s[2])}`}return""}};me.LogFormatter=We});var sr=u(nr=>{"use strict";Object.defineProperty(nr,"__esModule",{value:!0})});var or=u(ye=>{"use strict";Object.defineProperty(ye,"__esModule",{value:!0});ye.PowertoolLogFormatter=void 0;var Qi=Oe(),xe=class extends Qi.LogFormatter{formatAttributes(e){return{cold_start:e.lambdaContext?.coldStart,function_arn:e.lambdaContext?.invokedFunctionArn,function_memory_size:e.lambdaContext?.memoryLimitInMB,function_name:e.lambdaContext?.functionName,function_request_id:e.lambdaContext?.awsRequestId,level:e.logLevel,message:e.message,sampling_rate:e.sampleRateValue,service:e.serviceName,timestamp:this.formatTimestamp(e.timestamp),xray_trace_id:e.xRayTraceId}}};ye.PowertoolLogFormatter=xe});var Oe=u(E=>{"use strict";var ki=E&&E.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),He=E&&E.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&ki(e,t,r)};Object.defineProperty(E,"__esModule",{value:!0});He(ir(),E);He(sr(),E);He(or(),E)});var ot=u((Q,$)=>{var en=200,br="__lodash_hash_undefined__",tn=800,rn=16,vr=9007199254740991,pr="[object Arguments]",nn="[object Array]",sn="[object AsyncFunction]",on="[object Boolean]",an="[object Date]",un="[object Error]",mr="[object Function]",cn="[object GeneratorFunction]",ln="[object Map]",dn="[object Number]",fn="[object Null]",yr="[object Object]",gn="[object Proxy]",hn="[object RegExp]",_n="[object Set]",bn="[object String]",vn="[object Undefined]",pn="[object WeakMap]",mn="[object ArrayBuffer]",yn="[object DataView]",On="[object Float32Array]",Sn="[object Float64Array]",En="[object Int8Array]",Mn="[object Int16Array]",Ln="[object Int32Array]",wn="[object Uint8Array]",Cn="[object Uint8ClampedArray]",Pn="[object Uint16Array]",An="[object Uint32Array]",Tn=/[\\^$.*+?()[\]{}|]/g,jn=/^\[object .+?Constructor\]$/,Rn=/^(?:0|[1-9]\d*)$/,d={};d[On]=d[Sn]=d[En]=d[Mn]=d[Ln]=d[wn]=d[Cn]=d[Pn]=d[An]=!0;d[pr]=d[nn]=d[mn]=d[on]=d[yn]=d[an]=d[un]=d[mr]=d[ln]=d[dn]=d[yr]=d[hn]=d[_n]=d[bn]=d[pn]=!1;var Or=typeof global=="object"&&global&&global.Object===Object&&global,Nn=typeof self=="object"&&self&&self.Object===Object&&self,te=Or||Nn||Function("return this")(),Sr=typeof Q=="object"&&Q&&!Q.nodeType&&Q,k=Sr&&typeof $=="object"&&$&&!$.nodeType&&$,Er=k&&k.exports===Sr,Ze=Er&&Or.process,ar=function(){try{var t=k&&k.require&&k.require("util").types;return t||Ze&&Ze.binding&&Ze.binding("util")}catch{}}(),ur=ar&&ar.isTypedArray;function In(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}function Dn(t,e){for(var r=-1,i=Array(t);++r<t;)i[r]=e(r);return i}function Vn(t){return function(e){return t(e)}}function qn(t,e){return t?.[e]}function Bn(t,e){return function(r){return t(e(r))}}var Fn=Array.prototype,Un=Function.prototype,Me=Object.prototype,Je=te["__core-js_shared__"],Le=Un.toString,M=Me.hasOwnProperty,cr=function(){var t=/[^.]+$/.exec(Je&&Je.keys&&Je.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Mr=Me.toString,Gn=Le.call(Object),Kn=RegExp("^"+Le.call(M).replace(Tn,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Se=Er?te.Buffer:void 0,lr=te.Symbol,dr=te.Uint8Array,fr=Se?Se.allocUnsafe:void 0,Lr=Bn(Object.getPrototypeOf,Object),gr=Object.create,Xn=Me.propertyIsEnumerable,$n=Fn.splice,V=lr?lr.toStringTag:void 0,Ee=function(){try{var t=it(Object,"defineProperty");return t({},"",{}),t}catch{}}(),Yn=Se?Se.isBuffer:void 0,hr=Math.max,zn=Date.now,wr=it(te,"Map"),ee=it(Object,"create"),Wn=function(){function t(){}return function(e){if(!B(e))return{};if(gr)return gr(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}();function q(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var i=t[e];this.set(i[0],i[1])}}function xn(){this.__data__=ee?ee(null):{},this.size=0}function Hn(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}function Zn(t){var e=this.__data__;if(ee){var r=e[t];return r===br?void 0:r}return M.call(e,t)?e[t]:void 0}function Jn(t){var e=this.__data__;return ee?e[t]!==void 0:M.call(e,t)}function Qn(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=ee&&e===void 0?br:e,this}q.prototype.clear=xn;q.prototype.delete=Hn;q.prototype.get=Zn;q.prototype.has=Jn;q.prototype.set=Qn;function L(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var i=t[e];this.set(i[0],i[1])}}function kn(){this.__data__=[],this.size=0}function es(t){var e=this.__data__,r=we(e,t);if(r<0)return!1;var i=e.length-1;return r==i?e.pop():$n.call(e,r,1),--this.size,!0}function ts(t){var e=this.__data__,r=we(e,t);return r<0?void 0:e[r][1]}function rs(t){return we(this.__data__,t)>-1}function is(t,e){var r=this.__data__,i=we(r,t);return i<0?(++this.size,r.push([t,e])):r[i][1]=e,this}L.prototype.clear=kn;L.prototype.delete=es;L.prototype.get=ts;L.prototype.has=rs;L.prototype.set=is;function Y(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var i=t[e];this.set(i[0],i[1])}}function ns(){this.size=0,this.__data__={hash:new q,map:new(wr||L),string:new q}}function ss(t){var e=Pe(this,t).delete(t);return this.size-=e?1:0,e}function os(t){return Pe(this,t).get(t)}function as(t){return Pe(this,t).has(t)}function us(t,e){var r=Pe(this,t),i=r.size;return r.set(t,e),this.size+=r.size==i?0:1,this}Y.prototype.clear=ns;Y.prototype.delete=ss;Y.prototype.get=os;Y.prototype.has=as;Y.prototype.set=us;function z(t){var e=this.__data__=new L(t);this.size=e.size}function cs(){this.__data__=new L,this.size=0}function ls(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r}function ds(t){return this.__data__.get(t)}function fs(t){return this.__data__.has(t)}function gs(t,e){var r=this.__data__;if(r instanceof L){var i=r.__data__;if(!wr||i.length<en-1)return i.push([t,e]),this.size=++r.size,this;r=this.__data__=new Y(i)}return r.set(t,e),this.size=r.size,this}z.prototype.clear=cs;z.prototype.delete=ls;z.prototype.get=ds;z.prototype.has=fs;z.prototype.set=gs;function hs(t,e){var r=tt(t),i=!r&&et(t),n=!r&&!i&&Tr(t),s=!r&&!i&&!n&&Rr(t),a=r||i||n||s,o=a?Dn(t.length,String):[],c=o.length;for(var l in t)(e||M.call(t,l))&&!(a&&(l=="length"||n&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||Pr(l,c)))&&o.push(l);return o}function Qe(t,e,r){(r!==void 0&&!Ae(t[e],r)||r===void 0&&!(e in t))&&rt(t,e,r)}function _s(t,e,r){var i=t[e];(!(M.call(t,e)&&Ae(i,r))||r===void 0&&!(e in t))&&rt(t,e,r)}function we(t,e){for(var r=t.length;r--;)if(Ae(t[r][0],e))return r;return-1}function rt(t,e,r){e=="__proto__"&&Ee?Ee(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}var bs=As();function Ce(t){return t==null?t===void 0?vn:fn:V&&V in Object(t)?Ts(t):Vs(t)}function _r(t){return re(t)&&Ce(t)==pr}function vs(t){if(!B(t)||Is(t))return!1;var e=st(t)?Kn:jn;return e.test(Us(t))}function ps(t){return re(t)&&jr(t.length)&&!!d[Ce(t)]}function ms(t){if(!B(t))return Ds(t);var e=Ar(t),r=[];for(var i in t)i=="constructor"&&(e||!M.call(t,i))||r.push(i);return r}function Cr(t,e,r,i,n){t!==e&&bs(e,function(s,a){if(n||(n=new z),B(s))ys(t,e,a,r,Cr,i,n);else{var o=i?i(ke(t,a),s,a+"",t,e,n):void 0;o===void 0&&(o=s),Qe(t,a,o)}},Nr)}function ys(t,e,r,i,n,s,a){var o=ke(t,r),c=ke(e,r),l=a.get(c);if(l){Qe(t,r,l);return}var f=s?s(o,c,r+"",t,e,a):void 0,b=f===void 0;if(b){var R=tt(c),U=!R&&Tr(c),ie=!R&&!U&&Rr(c);f=c,R||U||ie?tt(o)?f=o:Gs(o)?f=ws(o):U?(b=!1,f=Es(c,!0)):ie?(b=!1,f=Ls(c,!0)):f=[]:Ks(c)||et(c)?(f=o,et(o)?f=Xs(o):(!B(o)||st(o))&&(f=js(c))):b=!1}b&&(a.set(c,f),n(f,c,i,s,a),a.delete(c)),Qe(t,r,f)}function Os(t,e){return Bs(qs(t,e,Ir),t+"")}var Ss=Ee?function(t,e){return Ee(t,"toString",{configurable:!0,enumerable:!1,value:Ys(e),writable:!0})}:Ir;function Es(t,e){if(e)return t.slice();var r=t.length,i=fr?fr(r):new t.constructor(r);return t.copy(i),i}function Ms(t){var e=new t.constructor(t.byteLength);return new dr(e).set(new dr(t)),e}function Ls(t,e){var r=e?Ms(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}function ws(t,e){var r=-1,i=t.length;for(e||(e=Array(i));++r<i;)e[r]=t[r];return e}function Cs(t,e,r,i){var n=!r;r||(r={});for(var s=-1,a=e.length;++s<a;){var o=e[s],c=i?i(r[o],t[o],o,r,t):void 0;c===void 0&&(c=t[o]),n?rt(r,o,c):_s(r,o,c)}return r}function Ps(t){return Os(function(e,r){var i=-1,n=r.length,s=n>1?r[n-1]:void 0,a=n>2?r[2]:void 0;for(s=t.length>3&&typeof s=="function"?(n--,s):void 0,a&&Rs(r[0],r[1],a)&&(s=n<3?void 0:s,n=1),e=Object(e);++i<n;){var o=r[i];o&&t(e,o,i,s)}return e})}function As(t){return function(e,r,i){for(var n=-1,s=Object(e),a=i(e),o=a.length;o--;){var c=a[t?o:++n];if(r(s[c],c,s)===!1)break}return e}}function Pe(t,e){var r=t.__data__;return Ns(e)?r[typeof e=="string"?"string":"hash"]:r.map}function it(t,e){var r=qn(t,e);return vs(r)?r:void 0}function Ts(t){var e=M.call(t,V),r=t[V];try{t[V]=void 0;var i=!0}catch{}var n=Mr.call(t);return i&&(e?t[V]=r:delete t[V]),n}function js(t){return typeof t.constructor=="function"&&!Ar(t)?Wn(Lr(t)):{}}function Pr(t,e){var r=typeof t;return e=e??vr,!!e&&(r=="number"||r!="symbol"&&Rn.test(t))&&t>-1&&t%1==0&&t<e}function Rs(t,e,r){if(!B(r))return!1;var i=typeof e;return(i=="number"?nt(r)&&Pr(e,r.length):i=="string"&&e in r)?Ae(r[e],t):!1}function Ns(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function Is(t){return!!cr&&cr in t}function Ar(t){var e=t&&t.constructor,r=typeof e=="function"&&e.prototype||Me;return t===r}function Ds(t){var e=[];if(t!=null)for(var r in Object(t))e.push(r);return e}function Vs(t){return Mr.call(t)}function qs(t,e,r){return e=hr(e===void 0?t.length-1:e,0),function(){for(var i=arguments,n=-1,s=hr(i.length-e,0),a=Array(s);++n<s;)a[n]=i[e+n];n=-1;for(var o=Array(e+1);++n<e;)o[n]=i[n];return o[e]=r(a),In(t,this,o)}}function ke(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}var Bs=Fs(Ss);function Fs(t){var e=0,r=0;return function(){var i=zn(),n=rn-(i-r);if(r=i,n>0){if(++e>=tn)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function Us(t){if(t!=null){try{return Le.call(t)}catch{}try{return t+""}catch{}}return""}function Ae(t,e){return t===e||t!==t&&e!==e}var et=_r(function(){return arguments}())?_r:function(t){return re(t)&&M.call(t,"callee")&&!Xn.call(t,"callee")},tt=Array.isArray;function nt(t){return t!=null&&jr(t.length)&&!st(t)}function Gs(t){return re(t)&&nt(t)}var Tr=Yn||zs;function st(t){if(!B(t))return!1;var e=Ce(t);return e==mr||e==cn||e==sn||e==gn}function jr(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=vr}function B(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}function re(t){return t!=null&&typeof t=="object"}function Ks(t){if(!re(t)||Ce(t)!=yr)return!1;var e=Lr(t);if(e===null)return!0;var r=M.call(e,"constructor")&&e.constructor;return typeof r=="function"&&r instanceof r&&Le.call(r)==Gn}var Rr=ur?Vn(ur):ps;function Xs(t){return Cs(t,Nr(t))}function Nr(t){return nt(t)?hs(t,!0):ms(t)}var $s=Ps(function(t,e,r){Cr(t,e,r)});function Ys(t){return function(){return t}}function Ir(t){return t}function zs(){return!1}$.exports=$s});var Dr=u(W=>{"use strict";var Ws=W&&W.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(W,"__esModule",{value:!0});W.LogItem=void 0;var xs=Ws(ot()),at=class{constructor(e){this.attributes={},this.addAttributes(e.baseAttributes),this.addAttributes(e.persistentAttributes)}addAttributes(e){return this.attributes=(0,xs.default)(this.attributes,e),this}getAttributes(){return this.attributes}prepareForPrint(){this.setAttributes(this.removeEmptyKeys(this.getAttributes()))}removeEmptyKeys(e){let r={};for(let i in e)e[i]!==void 0&&e[i]!==""&&e[i]!==null&&(r[i]=e[i]);return r}setAttributes(e){this.attributes=e}};W.LogItem=at});var qr=u(Vr=>{"use strict";Object.defineProperty(Vr,"__esModule",{value:!0})});var Fr=u(T=>{"use strict";var Hs=T&&T.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),Br=T&&T.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Hs(e,t,r)};Object.defineProperty(T,"__esModule",{value:!0});Br(Dr(),T);Br(qr(),T)});var Gr=u(Ur=>{"use strict";Object.defineProperty(Ur,"__esModule",{value:!0})});var Kr=u(Te=>{"use strict";Object.defineProperty(Te,"__esModule",{value:!0});Te.EnvironmentVariablesService=void 0;var Zs=H(),ut=class extends Zs.EnvironmentVariablesService{constructor(){super(...arguments),this.awsLogLevelVariable="AWS_LAMBDA_LOG_LEVEL",this.awsRegionVariable="AWS_REGION",this.currentEnvironmentVariable="ENVIRONMENT",this.functionNameVariable="AWS_LAMBDA_FUNCTION_NAME",this.functionVersionVariable="AWS_LAMBDA_FUNCTION_VERSION",this.logEventVariable="POWERTOOLS_LOGGER_LOG_EVENT",this.logLevelVariable="POWERTOOLS_LOG_LEVEL",this.logLevelVariableLegacy="LOG_LEVEL",this.memoryLimitInMBVariable="AWS_LAMBDA_FUNCTION_MEMORY_SIZE",this.sampleRateValueVariable="POWERTOOLS_LOGGER_SAMPLE_RATE"}getAwsLogLevel(){let e=this.get(this.awsLogLevelVariable);return e==="FATAL"?"CRITICAL":e}getAwsRegion(){return this.get(this.awsRegionVariable)}getCurrentEnvironment(){return this.get(this.currentEnvironmentVariable)}getFunctionMemory(){let e=this.get(this.memoryLimitInMBVariable);return Number(e)}getFunctionName(){return this.get(this.functionNameVariable)}getFunctionVersion(){return this.get(this.functionVersionVariable)}getLogEvent(){let e=this.get(this.logEventVariable);return this.isValueTrue(e)}getLogLevel(){let e=this.get(this.logLevelVariable),r=this.get(this.logLevelVariableLegacy);return e!==""?e:r}getSampleRateValue(){let e=this.get(this.sampleRateValueVariable);return e&&e.length>0?Number(e):void 0}};Te.EnvironmentVariablesService=ut});var $r=u(j=>{"use strict";var Js=j&&j.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),Xr=j&&j.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Js(e,t,r)};Object.defineProperty(j,"__esModule",{value:!0});Xr(Gr(),j);Xr(Kr(),j)});var lt=u(x=>{"use strict";var Qs=x&&x.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(x,"__esModule",{value:!0});x.Logger=void 0;var ks=require("node:crypto"),eo=require("node:console"),to=require("node:util"),ro=H(),io=Oe(),no=Fr(),je=Qs(ot()),so=$r(),ct=class t extends ro.Utility{get level(){return this.logLevel}constructor(e={}){super(),this.logEvent=!1,this.logIndentation=0,this.logLevel=12,this.logLevelThresholds={DEBUG:8,INFO:12,WARN:16,ERROR:20,CRITICAL:24,SILENT:28},this.logsSampled=!1,this.persistentLogAttributes={},this.powertoolLogData={},this.setOptions(e)}addContext(e){let r={invokedFunctionArn:e.invokedFunctionArn,coldStart:this.getColdStart(),awsRequestId:e.awsRequestId,memoryLimitInMB:Number(e.memoryLimitInMB),functionName:e.functionName,functionVersion:e.functionVersion};this.addToPowertoolLogData({lambdaContext:r})}addPersistentLogAttributes(e){(0,je.default)(this.persistentLogAttributes,e)}appendKeys(e){this.addPersistentLogAttributes(e)}createChild(e={}){let r={logLevel:this.getLevelName(),customConfigService:this.getCustomConfigService(),logFormatter:this.getLogFormatter()},i=this.getPowertoolLogData(),n=this.createLogger((0,je.default)(r,i,e)),s=this.getPersistentLogAttributes();return n.addPersistentLogAttributes(s),i.lambdaContext&&n.addContext(i.lambdaContext),n}critical(e,...r){this.processLogItem(24,e,r)}debug(e,...r){this.processLogItem(8,e,r)}error(e,...r){this.processLogItem(20,e,r)}getLevelName(){return this.getLogLevelNameFromNumber(this.logLevel)}getLogEvent(){return this.logEvent}getLogsSampled(){return this.logsSampled}getPersistentLogAttributes(){return this.persistentLogAttributes}info(e,...r){this.processLogItem(12,e,r)}injectLambdaContext(e){return(r,i,n)=>{let s=n.value,a=this;n.value=async function(o,c,l){let f={};e&&e.clearState===!0&&(f={...a.getPersistentLogAttributes()}),t.injectLambdaContextBefore(a,o,c,e);let b;try{b=await s.apply(this,[o,c,l])}catch(R){throw R}finally{t.injectLambdaContextAfterOrOnError(a,f,e)}return b}}}static injectLambdaContextAfterOrOnError(e,r,i){i&&i.clearState===!0&&e.setPersistentLogAttributes(r)}static injectLambdaContextBefore(e,r,i,n){e.addContext(i);let s;n&&n.hasOwnProperty("logEvent")&&(s=n.logEvent),e.logEventIfEnabled(r,s)}logEventIfEnabled(e,r){this.shouldLogEvent(r)&&this.info("Lambda invocation event",{event:e})}refreshSampleRateCalculation(){this.setLogsSampled()}removeKeys(e){this.removePersistentLogAttributes(e)}removePersistentLogAttributes(e){e.forEach(r=>{this.persistentLogAttributes&&r in this.persistentLogAttributes&&delete this.persistentLogAttributes[r]})}setLogLevel(e){if(!this.awsLogLevelShortCircuit(e))if(this.isValidLogLevel(e))this.logLevel=this.logLevelThresholds[e];else throw new Error(`Invalid log level: ${e}`)}setPersistentLogAttributes(e){this.persistentLogAttributes=e}setSampleRateValue(e){this.powertoolLogData.sampleRateValue=e||this.getCustomConfigService()?.getSampleRateValue()||this.getEnvVarsService().getSampleRateValue()}shouldLogEvent(e){return typeof e=="boolean"?e:this.getLogEvent()}warn(e,...r){this.processLogItem(16,e,r)}createLogger(e){return new t(e)}shouldPrint(e){return e>=this.logLevel?!0:this.getLogsSampled()}addToPowertoolLogData(...e){e.forEach(r=>{(0,je.default)(this.powertoolLogData,r)})}awsLogLevelShortCircuit(e){let r=this.getEnvVarsService().getAwsLogLevel();return this.isValidLogLevel(r)?(this.logLevel=this.logLevelThresholds[r],this.isValidLogLevel(e)&&this.logLevel>this.logLevelThresholds[e]&&this.warn((0,to.format)("Current log level (%s) does not match AWS Lambda Advanced Logging Controls minimum log level (%s). This can lead to data loss, consider adjusting them.",e,r)),!0):!1}createAndPopulateLogItem(e,r,i){let n=(0,je.default)({logLevel:this.getLogLevelNameFromNumber(e),timestamp:new Date,message:typeof r=="string"?r:r.message,xRayTraceId:this.envVarsService.getXrayTraceId()},this.getPowertoolLogData()),s=new no.LogItem({baseAttributes:this.getLogFormatter().formatAttributes(n),persistentAttributes:this.getPersistentLogAttributes()});return typeof r!="string"&&s.addAttributes(r),i.forEach(a=>{let o=a instanceof Error?{error:a}:typeof a=="string"?{extra:a}:a;s.addAttributes(o)}),s}getCustomConfigService(){return this.customConfigService}getEnvVarsService(){return this.envVarsService}getLogFormatter(){return this.logFormatter}getLogLevelNameFromNumber(e){return Object.entries(this.logLevelThresholds).find(([i,n])=>{if(n===e)return i})[0]}getPowertoolLogData(){return this.powertoolLogData}getReplacer(){let e=new WeakSet;return(r,i)=>{let n=i;if(n instanceof Error&&(n=this.getLogFormatter().formatError(n)),typeof n=="bigint")return n.toString();if(typeof n=="object"&&i!==null){if(e.has(n))return;e.add(n)}return n}}getSampleRateValue(){return this.powertoolLogData.sampleRateValue||this.setSampleRateValue(),this.powertoolLogData.sampleRateValue}isValidLogLevel(e){return typeof e=="string"&&e in this.logLevelThresholds}printLog(e,r){r.prepareForPrint();let i=e===24?"error":this.getLogLevelNameFromNumber(e).toLowerCase();this.console[i](JSON.stringify(r.getAttributes(),this.getReplacer(),this.logIndentation))}processLogItem(e,r,i){this.shouldPrint(e)&&this.printLog(e,this.createAndPopulateLogItem(e,r,i))}setConsole(){this.getEnvVarsService().isDevMode()?this.console=console:this.console=new eo.Console({stdout:process.stdout,stderr:process.stderr})}setCustomConfigService(e){this.customConfigService=e||void 0}setEnvVarsService(){this.envVarsService=new so.EnvironmentVariablesService}setInitialLogLevel(e){let r=e?.toUpperCase();if(this.awsLogLevelShortCircuit(r))return;if(this.isValidLogLevel(r)){this.logLevel=this.logLevelThresholds[r];return}let i=this.getCustomConfigService()?.getLogLevel()?.toUpperCase();if(this.isValidLogLevel(i)){this.logLevel=this.logLevelThresholds[i];return}let n=this.getEnvVarsService()?.getLogLevel()?.toUpperCase();if(this.isValidLogLevel(n)){this.logLevel=this.logLevelThresholds[n];return}}setLogEvent(){this.getEnvVarsService().getLogEvent()&&(this.logEvent=!0)}setLogFormatter(e){this.logFormatter=e||new io.PowertoolLogFormatter}setLogIndentation(){this.getEnvVarsService().isDevMode()&&(this.logIndentation=4)}setLogsSampled(){let e=this.getSampleRateValue();this.logsSampled=e!==void 0&&(e===1||(0,ks.randomInt)(0,100)/100<=e)}setOptions(e){let{logLevel:r,serviceName:i,sampleRateValue:n,logFormatter:s,customConfigService:a,persistentLogAttributes:o,environment:c}=e;return this.setEnvVarsService(),this.setConsole(),this.setCustomConfigService(a),this.setInitialLogLevel(r),this.setSampleRateValue(n),this.setLogsSampled(),this.setLogFormatter(s),this.setPowertoolLogData(i,c),this.setLogEvent(),this.setLogIndentation(),this.addPersistentLogAttributes(o),this}setPowertoolLogData(e,r,i={}){this.addToPowertoolLogData({awsRegion:this.getEnvVarsService().getAwsRegion(),environment:r||this.getCustomConfigService()?.getCurrentEnvironment()||this.getEnvVarsService().getCurrentEnvironment(),sampleRateValue:this.getSampleRateValue(),serviceName:e||this.getCustomConfigService()?.getServiceName()||this.getEnvVarsService().getServiceName()||this.getDefaultServiceName()},i)}};x.Logger=ct});var zr=u(Re=>{"use strict";Object.defineProperty(Re,"__esModule",{value:!0});Re.injectLambdaContext=void 0;var Yr=lt(),oo=Xe(),ao=(t,e)=>{let r=t instanceof Array?t:[t],i=[],n=e&&e.clearState===!0,s=c=>{c.internal={...c.internal,[oo.LOGGER_KEY]:o}},a=async c=>{r.forEach((l,f)=>{n&&(i[f]={...l.getPersistentLogAttributes()},s(c)),Yr.Logger.injectLambdaContextBefore(l,c.event,c.context,e)})},o=async()=>{n&&r.forEach((c,l)=>{Yr.Logger.injectLambdaContextAfterOrOnError(c,i[l],e)})};return{before:a,after:o,onError:o}};Re.injectLambdaContext=ao});var Wr=u(F=>{"use strict";var uo=F&&F.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),co=F&&F.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&uo(e,t,r)};Object.defineProperty(F,"__esModule",{value:!0});co(zr(),F)});var ze=u(m=>{"use strict";var lo=m&&m.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),Ne=m&&m.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&lo(e,t,r)};Object.defineProperty(m,"__esModule",{value:!0});Ne(rr(),m);Ne(lt(),m);Ne(Wr(),m);Ne(Oe(),m)});var go={};ti(go,{handler:()=>fo});module.exports=ri(go);var gt=Ie(Ye());var xr=Ie(ze()),Hr=Ie(Ye()),dt=new xr.Logger,ft=new Hr.Metrics;var fo=async t=>{try{for(record of t.Records){let{messageId:e,body:r,messageAttributes:i}=record,n={messageId:e,body:JSON.parse(r),messageAttributes:i};console.log("\u{1F680} ~ handler ~ response:",n),dt.info("receiveMessage User successfully"),ft.addMetric("receiveMessageUserSuccess",gt.MetricUnits.Count,1)}}catch(e){dt.error(e),ft.addMetric("receiveMessageSqsError",gt.MetricUnits.Count,1)}};0&&(module.exports={handler});
